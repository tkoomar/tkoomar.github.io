<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>map | Tanner Koomar</title>
    <link>/tags/map/</link>
      <atom:link href="/tags/map/index.xml" rel="self" type="application/rss+xml" />
    <description>map</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><copyright>2021</copyright><lastBuildDate>Mon, 20 Jul 2020 00:00:00 +0000</lastBuildDate>
    <image>
      <url>img/map[gravatar:%!s(bool=false) shape:square]</url>
      <title>map</title>
      <link>/tags/map/</link>
    </image>
    
    <item>
      <title>Australian Pets</title>
      <link>/post/2020-07-20-tt-australian-pets/</link>
      <pubDate>Mon, 20 Jul 2020 00:00:00 +0000</pubDate>
      <guid>/post/2020-07-20-tt-australian-pets/</guid>
      <description>

&lt;div id=&#34;TOC&#34;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#setup&#34;&gt;Setup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#peek-at-the-data&#34;&gt;Peek at the data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#get-a-map&#34;&gt;Get a Map&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#combine-map-and-data&#34;&gt;Combine Map and Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#combine-rehomed-and-released&#34;&gt;Combine Rehomed and Released&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;div id=&#34;setup&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Setup&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
library(sf)
library(ggtext)
library(patchwork)
library(showtext)
font_add_google(&amp;quot;Josefin Sans&amp;quot;, &amp;quot;Josefin Sans&amp;quot;)
showtext_auto()
animal_outcomes &amp;lt;- readr::read_csv(&amp;#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-21/animal_outcomes.csv&amp;#39;) %&amp;gt;%
  filter(year &amp;lt;= 2015)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;peek-at-the-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Peek at the data&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(animal_outcomes)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 12
##    year animal_type outcome   ACT   NSW    NT   QLD    SA   TAS   VIC    WA
##   &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;       &amp;lt;chr&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1  1999 Dogs        Reclai…   610  3140   205  1392  2329   516  7130     1
## 2  1999 Dogs        Rehomed  1245  7525   526  5489  1105   480  4908   137
## 3  1999 Dogs        Other      12   745   955   860   380   168  1001     6
## 4  1999 Dogs        Euthan…   360  9221     9  9214  1701   599  5217    18
## 5  1999 Cats        Reclai…   111   201    22   206   157    31   884     0
## 6  1999 Cats        Rehomed  1442  3913   269  3901  1055   752  3768    62
## # … with 1 more variable: Total &amp;lt;dbl&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;get-a-map&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Get a Map&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;au_sf &amp;lt;- rnaturalearth::ne_states(country = &amp;#39;Australia&amp;#39;, returnclass = &amp;#39;sf&amp;#39;) %&amp;gt;%
  mutate(state = str_remove(iso_3166_2, &amp;quot;AU-&amp;quot;))

ggplot(au_sf) + 
  geom_sf() + 
  theme_minimal() &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2020-07-20-tt-australian-pets/index_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;384&#34; /&gt;&lt;/p&gt;
&lt;div id=&#34;get-colors&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Get colors&lt;/h4&gt;
&lt;p&gt;Make a vector of colors for each state/territory.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;state_colors &amp;lt;- au_sf %&amp;gt;%   
  filter(state %in% colnames(animal_outcomes) &amp;amp; 
           !is.na(abbrev)) %&amp;gt;%
  as.data.frame() %&amp;gt;%
  transmute(name = name, 
            state = state, 
            color =  wesanderson::wes_palette(&amp;quot;BottleRocket2&amp;quot;, 
                                              n = 12, type = &amp;#39;c&amp;#39;)[c(1:6,9,12)] %&amp;gt;% 
              colorspace::lighten(amount = .2),
            name_md = glue::glue(&amp;quot;&amp;lt;b style=&amp;#39;color:{color}&amp;#39;&amp;gt;{name}&amp;lt;/b&amp;gt;&amp;quot;)
            ) &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;combine-map-and-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Combine Map and Data&lt;/h2&gt;
&lt;p&gt;Because the states / territories need to go into the rows (&lt;code&gt;sf&lt;/code&gt; has 1 row per geometry), we will be pivoting the data longer before we join.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;animal_outcomes_long &amp;lt;- animal_outcomes %&amp;gt;% 
  select(-Total) %&amp;gt;%
  pivot_longer(cols = 4:11, 
               names_to = &amp;#39;state&amp;#39;, 
               values_to = &amp;#39;count&amp;#39;) %&amp;gt;%
  pivot_wider(names_from = outcome, 
              values_from = count) %&amp;gt;%
  mutate_all(replace_na, 0) %&amp;gt;% 
  inner_join(state_colors, by = &amp;#39;state&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;combine-rehomed-and-released&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Combine Rehomed and Released&lt;/h2&gt;
&lt;p&gt;Wild animals are obviously released — rather than rehomed — but both can be viewed as the alternative to being euthanized, so we will combine them. Really not sure what “Other” would mean, so let’s just exclude it.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;animal_outcomes_long &amp;lt;- animal_outcomes_long %&amp;gt;%
  mutate(`Not Euthanized` = (Reclaimed + Rehomed + Released),
         ratio = (`Not Euthanized` + 1) / (Euthanized + 1)
         )

animal_outcomes_long[1:5,1:8]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5 x 8
##    year animal_type state Reclaimed Rehomed Other Euthanized Released
##   &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;       &amp;lt;chr&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
## 1  1999 Dogs        ACT         610    1245    12        360        0
## 2  1999 Dogs        NSW        3140    7525   745       9221        0
## 3  1999 Dogs        NT          205     526   955          9        0
## 4  1999 Dogs        QLD        1392    5489   860       9214        0
## 5  1999 Dogs        SA         2329    1105   380       1701        0&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;heatmap_plot &amp;lt;- animal_outcomes_long %&amp;gt;%
  ggplot(aes(x  = year, y = name_md, fill = ratio)) + 
    geom_tile() + 
    scale_fill_fermenter(palette = &amp;#39;Spectral&amp;#39;, 
                         limits = c(1/16, 16), 
                         breaks = c(1/16, 1/8, 1/4, 1/2, 1, 2, 4, 8, 16),
                         trans = &amp;#39;log2&amp;#39;, 
                         direction = 8, 
                         show.limits = F,
                         labels = c(&amp;#39;More\nEuthanizations&amp;#39;, 
                                    &amp;#39;8 x&amp;#39;, &amp;#39;4 x&amp;#39;, &amp;#39;2 x&amp;#39;, &amp;#39;1 x&amp;#39;, &amp;#39;2 x&amp;#39;, &amp;#39;4 x&amp;#39;, &amp;#39;8 x&amp;#39;,
                                    &amp;#39;More\nRehomes &amp;amp; Releases&amp;#39;),
                         guide = guide_colorsteps(title = NULL)
                         ) + 
    scale_x_continuous(expand = c(0,0)) + 
    facet_wrap(~animal_type, ncol = 3) + 
    labs(title = &amp;quot;Breakdown by Animal Type&amp;quot;) + 
    theme_bw(base_size = 16) + 
    theme(
      plot.title = element_text(hjust = 0.5), 
      plot.margin = margin(t = 25, b = 0),
      legend.box.margin = margin(),
      legend.margin = margin(b = -10),
      legend.position = &amp;#39;top&amp;#39;,
      axis.text.y.left = element_markdown(size = 12),
      panel.border = element_blank(),
      line = element_blank(),
      axis.title = element_blank(),
      axis.ticks.length = unit(0, &amp;#39;pt&amp;#39;), 
      legend.key.width = unit(100, &amp;#39;pt&amp;#39;),
      legend.key.height = unit(10, &amp;#39;pt&amp;#39;),
      strip.background = element_rect(color = NA, 
                                      fill = &amp;#39;grey95&amp;#39;)
    ) 

heatmap_plot&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2020-07-20-tt-australian-pets/index_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;au_map &amp;lt;- au_sf %&amp;gt;%   
  filter(state %in% colnames(animal_outcomes) &amp;amp; 
           !is.na(abbrev)) %&amp;gt;%
  ggplot(aes(fill = name)) + 
  geom_sf(color= &amp;#39;grey40&amp;#39;, size =1/8) + 
  scale_fill_manual(values = state_colors %&amp;gt;% select(name, color) %&amp;gt;% deframe(),
                    guide = guide_none()) + 
  theme_void() + 
  theme(legend.position = &amp;#39;none&amp;#39;, 
        legend.key = element_blank(), 
        plot.margin = margin()
        )

au_map&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2020-07-20-tt-australian-pets/index_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;line_plot &amp;lt;- animal_outcomes_long %&amp;gt;%
  group_by(name, year, name_md) %&amp;gt;%
  summarize(&amp;#39;Not Euthanized&amp;#39; = sum(`Not Euthanized`), 
            Euthanized = sum(Euthanized), 
            ratio  = (`Not Euthanized` + 1) / (Euthanized + 1),
            .groups = &amp;#39;keep&amp;#39;) %&amp;gt;%
  ggplot(aes(x = year, y = ratio, color = name_md)) + 
  geom_hline(yintercept = 1, color = &amp;#39;grey35&amp;#39;, size = 1) + 
  geom_smooth(alpha = 0, size = 1.75) + 
  scale_color_manual(values = state_colors %&amp;gt;% select(name_md, color) %&amp;gt;% deframe() %&amp;gt;%
                       alpha(0.85),
                     name = &amp;#39;State or Territory&amp;#39;) + 
  scale_y_continuous(limits = c(1/2, 16), 
                     breaks = c(1/2, 1, 2, 4, 8, 16),
                     trans = &amp;#39;log2&amp;#39;, 
                     labels = c(&amp;#39;More\nEuthanizations&amp;#39;,
                                &amp;#39;1 x&amp;#39;, &amp;#39;2 x&amp;#39;, &amp;#39;4 x&amp;#39;, &amp;#39;8 x&amp;#39;,
                                &amp;#39;More\nRehomes&amp;#39;), position = &amp;#39;right&amp;#39;) + 
  labs(title = &amp;#39;Total&amp;#39;) + 
  theme_bw(base_size = 14) + 
  theme(
    plot.title.position = &amp;#39;panel&amp;#39;,
    plot.margin = margin(), 
    aspect.ratio = 1, 
    panel.grid.major = element_line(size = 0.35, color = &amp;#39;grey70&amp;#39;), 
    panel.border = element_blank(),
    legend.text = element_markdown(), 
    legend.key = element_blank(),
    axis.title = element_blank(),
    axis.ticks.length = unit(0, &amp;#39;pt&amp;#39;), 
    legend.key.width = unit(0, &amp;#39;pt&amp;#39;),
    legend.key.height = unit(0, &amp;#39;pt&amp;#39;), 
    legend.position = &amp;#39;left&amp;#39;
  ) 

line_plot&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &amp;#39;loess&amp;#39; and formula &amp;#39;y ~ x&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Removed 3 rows containing non-finite values (stat_smooth).&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2020-07-20-tt-australian-pets/index_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;showtext_auto()
design &amp;lt;- &amp;quot;
AABBBB
AABBBB
CDDDDD
CDDDDD
CDDDDD

&amp;quot;

final_plot &amp;lt;- au_map + line_plot +  plot_spacer() + heatmap_plot + 
  plot_layout(design = design ) + 
  plot_annotation(title = &amp;#39;Animal Rehomes &amp;amp; Releases in Australia&amp;#39;,
                  caption = &amp;#39;A #tidytuesday adventure\nDesign by @TannerKoomar\nData from RSPCA&amp;#39;,
                  subtitle = &amp;#39;1999 - 2015&amp;#39;, 
                  theme = theme(title = element_text(size = 27, 
                                                     color = &amp;#39;grey40&amp;#39;, 
                                                     family = &amp;#39;Josefin Sans&amp;#39;),
                                plot.subtitle = element_text(size = 20), 
                                plot.caption = element_text(size = 10), 
                                text = element_text(size = 10)
                                )
                  ) + 
  theme(axis.text= element_text(size = 8)) &amp;amp;
  theme(text = element_text(color = &amp;#39;grey40&amp;#39;, family = &amp;#39;Josefin Sans&amp;#39;), 
        strip.text = element_text(color = &amp;#39;grey40&amp;#39;, family = &amp;#39;Josefin Sans&amp;#39;), 
        legend.title = element_text(color = &amp;#39;grey40&amp;#39;, family = &amp;#39;Josefin Sans&amp;#39;)
        ) 

final_plot&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &amp;#39;loess&amp;#39; and formula &amp;#39;y ~ x&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Removed 3 rows containing non-finite values (stat_smooth).&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2020-07-20-tt-australian-pets/index_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;960&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Tidy Tuesday: How The Housing Price Index Flipped</title>
      <link>/post/2019-04-21-tt-housing-prices/</link>
      <pubDate>Sun, 21 Apr 2019 00:00:00 +0000</pubDate>
      <guid>/post/2019-04-21-tt-housing-prices/</guid>
      <description>&lt;p&gt;A look at housing price trends over the last century with a compound infographic.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;a href=&#34;#format-data&#34;&gt;format data&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#a-new-theme&#34;&gt;A new theme&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#violin-plot&#34;&gt;violin plot&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#statebin-maps&#34;&gt;statebin maps&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#line-plots&#34;&gt;line plots&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#map-key&#34;&gt;map key&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#texts&#34;&gt;texts&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;a href=&#34;#title&#34;&gt;title&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#narrative&#34;&gt;narrative&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#footer&#34;&gt;footer&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#asemble&#34;&gt;Asemble&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;#the-final-plot&#34;&gt;The final Plot&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(tidyverse)
library(statebins)
library(cowplot)
library(magick)
library(showtext) ## for google fonts
font_add_google(&amp;quot;Staatliches&amp;quot;)
font_add_google(&amp;quot;Oswald&amp;quot;)
font_add_google(&amp;quot;Montserrat&amp;quot;, regular.wt = 300, bold.wt = 500)
showtext_auto()


## read in data
hpi_dat &amp;lt;- read_csv(&amp;quot;https://github.com/rfordatascience/tidytuesday/raw/master/data/2019/2019-02-05/state_hpi.csvhttps://github.com/rfordatascience/tidytuesday/raw/master/data/2019/2019-02-05/state_hpi.csv&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Parsed with column specification:
## cols(
##   year = col_integer(),
##   month = col_integer(),
##   state = col_character(),
##   price_index = col_double(),
##   us_avg = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;format-data&#34;&gt;format data&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;hpi_dat &amp;lt;- hpi_dat %&amp;gt;% 
  mutate(years =  cut(year, 
                       breaks = c(1975, 1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2018), 
                       labels = c(1975, 1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015), 
                       include.lowest = TRUE
                       )
         ) %&amp;gt;%
  group_by(years) %&amp;gt;%
  mutate(
    price_ratio = price_index/us_avg,
    price_sd = sd(price_index/us_avg)
    ) %&amp;gt;% 
  ungroup() %&amp;gt;%
  left_join(tibble(state = state.abb, region = as.character(state.division))) %&amp;gt;%
  mutate(region = replace_na(region, &amp;quot;Washington DC&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Joining, by = &amp;quot;state&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;a-new-theme&#34;&gt;A new theme&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;theme_house&amp;lt;- function(base_size = 11, base_family = &amp;quot;Oswald&amp;quot;, base_line_size = base_size/22, base_rect_size = base_size/22) {
      theme_minimal(base_size = base_size, 
               base_family = base_family,
               base_line_size = base_line_size, 
               base_rect_size = base_rect_size) %+replace% 
    theme(axis.title = element_text(face = &#39;bold&#39;, hjust = 0, size = 14),
          strip.text = element_text(hjust = 1))
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;violin-plot&#34;&gt;violin plot&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;violin &amp;lt;- hpi_dat %&amp;gt;%
  ggplot(aes(x = years, y = (price_ratio), fill = price_sd)) + 
  geom_hline(yintercept = 1 , lty = 2) + 
  geom_violin(color = NA, alpha = 0.85) + 
  scale_fill_gradientn(colors = c(&amp;quot;#F98400&amp;quot;,&amp;quot;#ECCBAE&amp;quot;), name = &#39;standard deviation of home prices&#39;) + 
  labs(x = &amp;quot;5 year period&amp;quot;, 
       y = &amp;quot;HPI relative to national average&amp;quot;
       ) + 
  guides(fill = guide_colorbar(title.position = &amp;quot;top&amp;quot;, 
                               title.hjust = 0.5, 
                               label.position = &#39;bottom&#39;, 
                               barwidth = 15, 
                               barheight = .5)
         ) + 
  scale_y_continuous(trans = &#39;log2&#39;, breaks = c(1/2, 1, 2), labels = c(&amp;quot;1/2x&amp;quot;, &amp;quot;1x&amp;quot;, &amp;quot;2x&amp;quot;), limits = c(1/2,2)) + 
  #scale_fill_viridis_c(direction = -1, option = &amp;quot;E&amp;quot;) + 
  theme_house() + 
  theme(legend.direction = &#39;horizontal&#39;, 
        legend.justification = c(.5, 0),
        legend.position = c(0.5, 0.78)
        )

violin
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Removed 1 rows containing non-finite values (stat_ydensity).
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;2019-02-05_files/figure-markdown_github/unnamed-chunk-3-1.png&#34; alt=&#34; &#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;statebin-maps&#34;&gt;statebin maps&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;bin_maps &amp;lt;- hpi_dat %&amp;gt;%
  filter(years %in% c(1975, 1995, 2015)) %&amp;gt;%
  ggplot(aes(state = state, 
             fill = cut(log2(price_ratio), 
                        breaks = c(-Inf, -.625, -.375, -.125, .125, .375, .625, Inf), include.lowest = TRUE,
                        labels = c(&amp;quot;-1&amp;quot;, &amp;quot;-1/2&amp;quot;, &amp;quot;-1/4&amp;quot;, &amp;quot;0&amp;quot;, &amp;quot;1/4&amp;quot;, &amp;quot;1/2&amp;quot;, &amp;quot;1&amp;quot;)
                        )
             ) 
         ) + 
  geom_statebins(border_size = 0, dark_lbl = NA, light_lbl = NA) + 
  facet_wrap(~years, nrow = 3) + 
  coord_equal() + 
  guides(fill = guide_legend(title.position = &#39;top&#39;,
                             title.hjust = 0.5, 
                             label.position = &#39;bottom&#39;, 
                             direction = &#39;horizontal&#39;, 
                             nrow = 1, 
                             keyheight = .75, 
                             keywidth = c(2, 1, 1, 2, 1, 1, 2)
                             )
         ) + 
  scale_fill_manual(values = colorRampPalette(c(&amp;quot;#FF0000&amp;quot;, &amp;quot;#fbf4ee&amp;quot;, &amp;quot;#00A08A&amp;quot;))(7),  
                    name = &amp;quot;HPI relative to national average&amp;quot;, 
                    labels = c(&amp;quot;1/2x&amp;quot;, &amp;quot;&amp;quot;, &amp;quot;&amp;quot;, &amp;quot;1x&amp;quot;, &amp;quot;&amp;quot;, &amp;quot;&amp;quot;, &amp;quot; 2x&amp;quot;)) + 
  ggtitle(&amp;quot;Home Prices in Flyover\nCountry Can&#39;t Keep Up&amp;quot;) + 
  theme_void() + 
  theme(plot.title=element_text(family = &amp;quot;Oswald&amp;quot;, 
                                size=20, 
                                hjust=1, 
                                lineheight = 0.85), 
        plot.margin = margin(0,10,0,10), 
        strip.text = element_text(family = &amp;quot;Oswald&amp;quot;, 
                                  size = 24,
                                  hjust = 0),
        legend.position = &#39;top&#39;, 
        legend.justification = 0.5,
        legend.direction = &#39;horizontal&#39;, 
        legend.text = element_text(family = &amp;quot;Oswald&amp;quot;)
       )

bin_maps
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;2019-02-05_files/figure-markdown_github/unnamed-chunk-4-1.png&#34; alt=&#34; &#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;line-plots&#34;&gt;line plots&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;lines &amp;lt;- hpi_dat %&amp;gt;%
  group_by(year, region) %&amp;gt;%
  ggplot(aes(x = year, y = price_ratio, color = region, group = region)) + 
  geom_hline(yintercept = 1, lty = 2, lwd = 0.25) + 
  scale_y_continuous(trans = &#39;log2&#39;, breaks = c(1/2, 1, 2), labels = c(&amp;quot;1/2x&amp;quot;, &amp;quot;1x&amp;quot;, &amp;quot;2x&amp;quot;), limits = c(1/2,2)) + 
  labs(y = &amp;quot;HPI relative to national average&amp;quot;) + 
  geom_line(alpha = 0.85, size = 4, show.legend = FALSE) + 
  facet_wrap(~region, ncol = 2) + 
  scale_color_manual(values = c(&amp;quot;#FF0000&amp;quot;, &amp;quot;#00A08A&amp;quot;, &amp;quot;#F2AD00&amp;quot;, &amp;quot;#F98400&amp;quot;, &amp;quot;#5bd679&amp;quot;, &amp;quot;#ECCBAE&amp;quot;, &amp;quot;#046C9A&amp;quot;, &amp;quot;#000000&amp;quot;, &amp;quot;#ABDDDE&amp;quot;, &amp;quot;#D69C4E&amp;quot; )) +
  theme_house() + 
  theme(axis.title = element_text(size = 22))
lines
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Removed 1 rows containing missing values (geom_path).
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;2019-02-05_files/figure-markdown_github/unnamed-chunk-5-1.png&#34; alt=&#34; &#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;map-key&#34;&gt;map key&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;bin_map_key &amp;lt;- hpi_dat %&amp;gt;%
  left_join(tibble(state = state.abb, region = state.division)) %&amp;gt;%
  ggplot(aes(state = state, fill = region)) + 
  geom_statebins(border_size = 0, family = &amp;quot;Montserrat&amp;quot; ) + 
  scale_fill_manual(values = c(&amp;quot;#FF0000&amp;quot;, &amp;quot;#00A08A&amp;quot;, &amp;quot;#F2AD00&amp;quot;, &amp;quot;#F98400&amp;quot;, &amp;quot;#5bd679&amp;quot;, &amp;quot;#ECCBAE&amp;quot;, &amp;quot;#046C9A&amp;quot;, &amp;quot;#000000&amp;quot;, &amp;quot;#ABDDDE&amp;quot;, &amp;quot;#D69C4E&amp;quot;)) + 
  coord_equal() + 
  ggtitle(&amp;quot;Regions of the United States&amp;quot;) + 
  theme_void() + 
  theme(plot.title=element_text(family = &amp;quot;Oswald&amp;quot;, size=20, hjust=0), 
        plot.margin = margin(10,10,10,10), 
        legend.position = &#39;none&#39;
        ) 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Joining, by = c(&amp;quot;state&amp;quot;, &amp;quot;region&amp;quot;)

## Warning: Column `region` joining character vector and factor, coercing into
## character vector
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;bin_map_key
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;2019-02-05_files/figure-markdown_github/unnamed-chunk-6-1.png&#34; alt=&#34; &#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;texts&#34;&gt;texts&lt;/h2&gt;
&lt;h4 id=&#34;title&#34;&gt;title&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;header &amp;lt;- ggplot() + 
 annotate(geom = &amp;quot;text&amp;quot;, 
          y = -0.1, 
          x = 0.5, 
          size = 10,
          family = &amp;quot;Staatliches&amp;quot;,
          color = &#39;white&#39;,
          alpha = 1,
          lineheight = 0.7,
          hjust = 1,
          label=&amp;quot;HOW THE HOUSING\nPRICE INDEX&amp;quot;
          ) + 
   annotate(geom = &amp;quot;text&amp;quot;, 
          y = -0.1, 
          x = .79, 
          size = 12,
          family = &amp;quot;Staatliches&amp;quot;, 
          color = &#39;white&#39;,
          alpha = 1,
          lineheight = 0.9,
          hjust = 0,
          label=&amp;quot;FLIPPED&amp;quot; 
          ) + 
  ylim(-2,2) + 
  xlim(-2,2) + 
  theme_void() + 
  theme(
    plot.background = element_rect(color = &amp;quot;white&amp;quot;,
                                   fill = &amp;quot;transparent&amp;quot;, 
                                   size = 5)
  )


ggdraw() + draw_image(&amp;quot;house.png&amp;quot;) + draw_plot(header)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;2019-02-05_files/figure-markdown_github/unnamed-chunk-7-1.png&#34; alt=&#34; &#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;narrative&#34;&gt;narrative&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;narr &amp;lt;- ggplot() + 
 annotate(geom = &amp;quot;text&amp;quot;, 
          y = 0, 
          x= -2, 
          size = 5.5, 
          family = &amp;quot;Montserrat&amp;quot;, 
          color = &#39;black&#39;,
          alpha = 0.75, 
          lineheight = 0.9,
          hjust = 0,
          label=str_wrap(&amp;quot;In the 1970&#39;s, many individual states had average home prices (HPI) above the national average. The spread of house prices narrowed, until the mid 1990&#39;s. After this inflection point, house prices again grew more extreme. Less populous states drive this trend, with home prices in these regions going from above average to below it.&amp;quot;, 30)
          ) + 
  ylim(-2,2) + 
  xlim(-2,2) + 
  theme_void() + 
  theme(
    plot.background = element_rect(color = &amp;quot;white&amp;quot;,
                                   fill = &#39;#e5e5ff&#39;, 
                                   size = 5)
  )

narr
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;2019-02-05_files/figure-markdown_github/unnamed-chunk-8-1.png&#34; alt=&#34; &#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;footer&#34;&gt;footer&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;foot &amp;lt;- ggplot() + 
 annotate(geom = &amp;quot;text&amp;quot;, 
          y = 0, 
          x= 0, 
          size = 3, 
          family = &amp;quot;Montserrat&amp;quot;, 
          color = &#39;black&#39;,
          alpha = 0.5,
          hjust = 0.5,
          label= &amp;quot;◊ A #TidyTuesday adventure by @TannerKoomar ◊ Data from Freddie Mac ◊ Photo from pexels.com ◊&amp;quot;
          ) + 
  ylim(-2,2) + 
  xlim(-2,2) + 
  theme_void() + 
  theme(
    plot.background = element_rect(color = &amp;quot;white&amp;quot;,
                                   fill = &#39;#e5e5ff&#39;, 
                                   size = 3)
  )

foot
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;2019-02-05_files/figure-markdown_github/unnamed-chunk-9-1.png&#34; alt=&#34; &#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;asemble&#34;&gt;Asemble&lt;/h2&gt;
&lt;p&gt;let&amp;rsquo;s try cowplot this time&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;final_plot &amp;lt;- plot_grid(
  (ggdraw() + draw_image(&amp;quot;house.png&amp;quot;) + draw_plot(header)), 
  plot_grid(violin, 
            narr, 
            rel_widths = c(5,3)
            ),
  plot_grid(
            plot_grid(bin_maps + theme(plot.background = element_rect(fill = alpha(&#39;#e5e5ff&#39;, 0.25), 
                                                                      color = &#39;white&#39;, 
                                                                      size = 2)
                                       ),
                      bin_map_key, 
                      ncol = 1,
                      rel_heights = c(3,1)
                      ), 
            lines, 
            rel_widths = c(3, 5)
            ),
  foot,
  ncol = 1, 
  rel_heights = c(1, 2, 6, 0.15)
)

png(&amp;quot;final_plot.png&amp;quot;, width = 1000, height = 2000, res = 144, bg = &amp;quot;white&amp;quot;)
final_plot
dev.off()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## png 
##   2
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;the-final-plot&#34;&gt;The final Plot&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;./featured.png&#34; alt=&#34;The final plot&#34;&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Tidy Tuesday: USA Wind Power</title>
      <link>/post/2018-11-06-tt-wind-power/</link>
      <pubDate>Tue, 06 Nov 2018 00:00:00 +0000</pubDate>
      <guid>/post/2018-11-06-tt-wind-power/</guid>
      <description>&lt;div id=&#34;load-data&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Load Data&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat &amp;lt;- read_csv(&amp;quot;https://github.com/rfordatascience/tidytuesday/raw/master/data/2018/2018-11-06/us_wind.csv&amp;quot;)

## get all the missing data to NA
dat &amp;lt;- dat %&amp;gt;% mutate_all(.funs = funs(replace(., . %in% c(-9999, &amp;quot;missing&amp;quot;), NA)))

## drop rows and columns with high missing rate
dat.comp &amp;lt;- dat %&amp;gt;% select_if( function(x){sum(is.na(x))/length(x) &amp;lt; .15}) %&amp;gt;%
  filter(rowMeans(is.na(.)) &amp;lt; 0.15)

## get info at project level
dat.p.num &amp;lt;- dat.comp %&amp;gt;% group_by(p_name) %&amp;gt;% 
  select_if(is.numeric) %&amp;gt;% select(-case_id) %&amp;gt;%
  summarise_all(.funs = function(x){mean(x, na.rm = T)}) %&amp;gt;% 
  ungroup %&amp;gt;% select(-p_name) %&amp;gt;% filter(rowSums(is.na(.)) == 0) %&amp;gt;%
  filter(xlong &amp;lt; 100 &amp;amp; xlong &amp;gt; -125 &amp;amp; ylat &amp;gt; 20) %&amp;gt;% ## remove some geographic outliers
  filter(t_cap &amp;gt; 0) &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;reduce-dimensionality&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Reduce Dimensionality&lt;/h2&gt;
&lt;div id=&#34;do-a-pca&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Do a PCA&lt;/h3&gt;
&lt;p&gt;Looks like PC1 makes up the bulk of the difference, and it is due to turbine rotor sweep area&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat.pca &amp;lt;- prcomp(dat.p.num, center = TRUE, scale. = TRUE)

broom::tidy(dat.pca, &amp;#39;d&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 12 x 4
##       PC std.dev percent cumulative
##    &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
##  1     1  2.34   0.456        0.456
##  2     2  1.38   0.158        0.615
##  3     3  1.01   0.0846       0.699
##  4     4  0.983  0.0806       0.780
##  5     5  0.950  0.0753       0.855
##  6     6  0.860  0.0617       0.917
##  7     7  0.704  0.0413       0.958
##  8     8  0.537  0.0240       0.982
##  9     9  0.355  0.0105       0.993
## 10    10  0.278  0.00645      0.999
## 11    11  0.109  0.001        1.00 
## 12    12  0.0102 0.00001      1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat.pca$rotation %&amp;gt;% as.data.frame() %&amp;gt;% rownames_to_column() %&amp;gt;%
  ggplot(aes(y = PC1, x = rowname)) + 
  geom_col()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-11-06-tt-wind-power/index_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;some-plots&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Some plots&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat.p.num %&amp;gt;% 
  bind_cols(as.tibble(dat.pca$x)) %&amp;gt;%
  ggplot(aes(x = xlong, ylat, color = PC1, size = p_cap, alpha = t_cap)) +
  scale_color_viridis_c() + 
  geom_point()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-11-06-tt-wind-power/index_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;cluster&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Cluster&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## Use the PCs that explain 95% of the variance
dat.k &amp;lt;- dat.pca$x %&amp;gt;% as.tibble %&amp;gt;%
  select(1:7) %&amp;gt;%
  mutate(
    k2 = kmeans(., 2)$cluster, 
    k3 = kmeans(., 3)$cluster,
    k4 = kmeans(., 4)$cluster,
    k5 = kmeans(., 5)$cluster,
    k6 = kmeans(., 6)$cluster
  ) %&amp;gt;% bind_cols(dat.p.num)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;summary-of-clusters&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Summary of Clusters&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat.k %&amp;gt;%
  group_by(k6) %&amp;gt;%
  select(-matches(&amp;#39;^PC|k\\d&amp;#39;)) %&amp;gt;%
  summarise_all(list(.median = median, .mad = mad))%&amp;gt;%
  gather(key, value, -k6) %&amp;gt;%
  separate(key, into = c(&amp;#39;measure&amp;#39;, &amp;#39;stat&amp;#39;), &amp;#39;\\.&amp;#39;) %&amp;gt;%
  mutate(measure = str_remove(measure, &amp;quot;_$&amp;quot;), 
    k6 = as.factor(k6)) %&amp;gt;%
  spread(stat, value) %&amp;gt;%
  ggplot(aes(x = k6, y = median, color = k6)) + 
  geom_errorbar(aes(ymin = median-3*mad, ymax = median+3*mad)) + 
  geom_point() + 
  facet_wrap(~measure, scales = &amp;#39;free&amp;#39;)+ 
  theme_minimal() + 
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;, guide = guide_none())&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-11-06-tt-wind-power/index_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;cluster-plots&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Cluster Plots&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat.k %&amp;gt;% 
  ggplot(aes(x = xlong, ylat, color = as.character(k6), size = p_cap, alpha = t_cap)) +
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;) + 
  geom_point()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-11-06-tt-wind-power/index_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat.k %&amp;gt;% 
  ggplot(aes(x = xlong, ylat, color = as.character(k6), size = p_cap, alpha = t_cap)) +
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;)+ 
  geom_point() + 
  facet_wrap(~ as.character(k6), nrow = 3)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-11-06-tt-wind-power/index_files/figure-html/unnamed-chunk-6-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;make-a-pretty-map-under-the-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Make a pretty map under the data&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(ggmap)
invert &amp;lt;- function(M) {
  i &amp;lt;- function(x){rgb(t(255-col2rgb(x))/255)}
  
  m &amp;lt;- M %&amp;gt;% apply(2, i) %&amp;gt;% as.raster()
  
  class(m) &amp;lt;- class(M)
  attr(m, &amp;quot;bb&amp;quot;) &amp;lt;- attr(M, &amp;quot;bb&amp;quot;)
  return(m)
  }

us &amp;lt;- c(left = -125, bottom = 25.75, right = -67, top = 49)
m &amp;lt;- get_stamenmap(us, zoom = 5, maptype = &amp;quot;toner-lite&amp;quot;) 
ggmap(invert(m))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-11-06-tt-wind-power/index_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;plots&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Plots&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot.points &amp;lt;- ggmap(invert(m), extent = &amp;#39;device&amp;#39;) + 
  geom_point(aes(x = xlong, y = ylat, color = as.character(k6), size = p_cap, alpha = t_cap), data = dat.k, pch = 18) + 
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;) + 
  facet_wrap(~k6, ncol = 1) + 
  theme_void() + 
  theme(legend.position = &amp;#39;none&amp;#39;, strip.text = element_blank()) + 
  theme(plot.background = element_rect(fill = &amp;quot;black&amp;quot;, color = &amp;quot;black&amp;quot;), 
        panel.background = element_rect(fill = NULL))

plot.density &amp;lt;- ggmap(invert(m), extent = &amp;#39;device&amp;#39;) + 
  stat_density2d(aes(x = xlong, y = ylat, alpha = ..level.., fill = as.character(k6), color = NULL), data = dat.k, geom = &amp;quot;polygon&amp;quot;) + 
  scale_fill_brewer(palette = &amp;quot;Set1&amp;quot;) + 
  facet_wrap(~k6, ncol = 1) + 
  theme_void() + 
  theme(legend.position = &amp;#39;none&amp;#39;, strip.text = element_blank()) + 
  theme(plot.background = element_rect(fill = &amp;quot;black&amp;quot;, color = &amp;quot;black&amp;quot;), 
        panel.background = element_rect(fill = NULL))

plot.all &amp;lt;- ggmap(invert(m), extent = &amp;#39;device&amp;#39;) + 
  geom_point(aes(x = xlong, y = ylat, color = as.character(k6), size = p_cap, alpha = t_cap), data = dat.k, pch = 18) + 
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;) + 
  guides(
    size = guide_legend(title = &amp;quot;project capacity&amp;quot;,title.position = &amp;#39;top&amp;#39;, override.aes = list(color = &amp;quot;white&amp;quot;)),
    alpha = guide_legend(title = &amp;quot;turbine capacity&amp;quot;,title.position = &amp;#39;top&amp;#39;, override.aes = list(color = &amp;quot;white&amp;quot;, size  = 4)), 
    color = guide_legend(title = &amp;#39;cluster&amp;#39;, title.position = &amp;#39;top&amp;#39;, override.aes = list(size = 4))
  ) + 
  ggtitle(&amp;quot;US Wind Turbine Projects&amp;quot;, &amp;quot;  a #tidytuesday adventure&amp;quot;) +
  theme_void() + 
  theme(title = element_text(color = &amp;#39;white&amp;#39;),
        legend.position = &amp;#39;bottom&amp;#39;, 
        legend.background = element_blank(),
        legend.text = element_text(color = &amp;quot;white&amp;quot;),
        legend.title = element_text(color = &amp;quot;white&amp;quot;),
        legend.key = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        plot.background = element_rect(fill = &amp;quot;black&amp;quot;, color = &amp;quot;black&amp;quot;), 
        panel.background = element_rect(fill = NULL))&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;squish-together&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Squish together&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(cowplot)

final.plot &amp;lt;- plot_grid(plotlist = list(plot.points, plot.all, plot.density), nrow = 1, rel_widths = c(.25,1,.25))
ggdraw(final.plot) + 
  theme(plot.background = element_rect(fill = &amp;quot;black&amp;quot;, color = 
&amp;quot;black&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-11-06-tt-wind-power/index_files/figure-html/final-plot-1.png&#34; width=&#34;960&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
